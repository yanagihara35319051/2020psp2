# t分布

$$
p(t;m) = \frac{\Gamma \left( \frac{m+1}{2}\right)}
{\sqrt{m\pi} \Gamma \left( \frac{m}{2} \right)}\left( 1+ \frac{t^2}{m} \right)^{-\frac{m+1}{2}} 
$$

正規分布$Norm(\mu,\sigma^2)$に従うと思われる標本（$N$）で求めた以下の統計量$T$の出現確率は自由度$N-1$のt分布に従う．

$$
T = \frac{\bar{x}-\mu}{\sqrt{\frac{u^2}{N}}}\quad\sim t_{N-1}
$$

真の母分散$\sigma^2$がわからなくともよい．

そもそもは，
統計量$Z(\bar{x},N,\mu,\sigma^2)$が，$Norm(\mu,\sigma^2)$に従い，
統計量$W(\bar{x},N,\sigma^2)$が，$\chi^2(N-1)$に従い，
$Z$と$W$を用いて$\sigma^2$を相殺して消したものです．

$$
Z = \frac{\bar{x}-\mu}{\sqrt{\frac{\sigma^2}{N}}} \quad \sim Norm(0,1)
$$

$$
W = \frac{1}{\sigma^2}\sum_{i=1}^{N}(x_i-\bar{x})^2 \quad \sim \chi^2(N-1)
$$

不偏分散$u^2 = \frac{1}{N-1}\sum_{i=1}^{N}(x_i-\bar{x})^2$を使うと，$W$は，

$$
W = (N-1)\frac{u^2}{\sigma^2} \quad \sim \chi^2(N-1)
$$

となり，$Z$を$W$の2乗根で割ると，$\sigma^2$が消えます．
$$
\frac{Z}{\sqrt{W}} = \frac{\frac{\bar{x}-\mu}{\sqrt{\frac{\sigma^2}{N}}}}{\sqrt{(N-1)\frac{u^2}{\sigma^2}}}
= \frac{\frac{\sqrt{N}(\bar{x}-\mu)}{\sigma}}{\frac{\sqrt{N-1}u}{\sigma}} 
= \frac{\sqrt{N}(\bar{x}-\mu)}{\sqrt{N-1}u}
$$

$Z$における$\sigma^2$を$u^2$に変えたものになると使い勝手がよさそうで，それを$T$とします．

$$
T = \frac{\bar{x}-\mu}{\sqrt{\frac{u^2}{N}}}
  = \frac{Z}{\sqrt{\frac{W}{N-1}}}
$$

## 2群の平均の差の有無についての検定

データそのものでなく，データの差が問題となっている．

データの差を新しいデータとすると，差データについて，統計量$Z$だとか$T$などを求めて，標準正規分布だとかT分布とかと比較すればよい．

### 差データの母平均

差が無いときの差データの母平均は意味からしてゼロである．

### 差データの母分散

#### 既知

$\sigma^2$とわかっていれば，$Z$を求められる．差データの標本平均を$\bar{d}$とすれば，$n_m$,$n_f$を2群それぞれのサイズとして，

$$
Z = \frac{\bar{d}-0}{\sqrt{\frac{\sigma^2}{n_m}+\frac{\sigma^2}{n_f}}}
$$

分母の$\frac{\sigma^2}{n_m}+\frac{\sigma^2}{n_f}$だが，サイズが2群で異なるので，調和平均で平均的サイズを求めているに過ぎない．

$$
\frac{1}{n} = \frac{1}{n_m} + \frac{1}{n_f}
$$

#### 未知

未知のときは，不偏分散$u^2$を使って$T$分布だが，2群それぞれで不偏分散が異なる($u_m^2$と$u_f^2$)．そもそも不偏分散は母分散の推定値であり，推定値は1つにしないといけない．

* 2群それぞれの母分散が異なるとき，差の母分散の推定は信用度が下がる，
  というか難しいことは想像できる．過去の様々な研究から，Welchという人が，例の$T$値の分母$\frac{u^2}{n}$を
  
  $$
  \frac{u_m^2}{n_m}+\frac{u_f^2}{n_f}
  $$
  
  としたものを考えている．直観的で簡単に見えるが，比較するt分布の自由度が複雑である．

* 2群それぞれの母分散が等しいと想定できるなら，ぐっと簡単になり，まず平均的な不偏分散を求める．それぞれの自由度による重み平均である．
  
  $$
  u^2 = \frac{n_m-1}{(n_m-1)+(n_f-1)}u_m^2 + \frac{n_f-1}{(n_m-1)+(n_f-1)}u_f^2
  $$

  あとは母分散既知のときの$\sigma^2$のかわりに$u^2$を使うだけで，

  $$
  T = \frac{\bar{d}-0}{\sqrt{\frac{u^2}{n_m}+\frac{u^2}{n_f}}}
  $$

  が自由度$n_m-1+n_f-1$のt分布に従う．

## t分布におけるT値以上の出現確率

一番上に示したt分布の式で求められるが，$\Gamma$関数が厄介である．

よって，t検定では，出現確率が1%未満だとか5%未満だとかになるT値の限界値を現実的な自由度ごとの表によって与えている．標本から求めたTがこの限界値より大きく離れるほど，そのT以上の確率は1％や5％未満となる．

表は，統計の教科書などに絶対載ってる．

